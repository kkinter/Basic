## 대용량 시스템

- 핵심은 DB다

- 정규화, 인덱스, 트랜잭션, 동시성 제어

- 대용량 시스템을 공부하기 위한 이정표

- SNS 프로젝트를 원하는 기술 스택을 활용해 다시 만들어 보세요

- 부하테스트 feat. ngrinder jmeter

- 그리고 MSA로 발전시켜보세요

### 웹의 기본 아키텍쳐

클라이언트 웹 서버 데이터베이스 ( 3-Tier 아키텍쳐)

클라잉너트 | 웹 서버(정적인 데이터 html, css 등) |  웹 어플리케이션 서버(동적인 정보) 데이터베이스

### 핵심

**관심사의 분리** | 컴포넌트에 맞게 구분을 하게 되면, 잘게 분리를 하게 되면 역할에 맞는 다양한 최적화 기법을 사용할 수 있음. 문제의 범위를 줄일 수 있음

코드 작성시에도 염두, 클래스간의 의존 관계 레이어 계층의 역할 << 유지보수하기 좋은 코드

 관측가능한 시스템 |

 효율적인 리소스 사용 |

레이어가 많아질 수록 관리 포인트가 많아짐 > 시스템의 복잡도 굉장히 증가

장 단점의 균형을 잘 잡아가는 게 중요

클라이언트는 무한정으로 늘릴 수 있으나

서버, DB는 한정적임

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-36-25-image.png)

### DB는 왜 병목일까?

> ? 스케일 업 스케일 아웃

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-37-24-image.png)

|           | 스케일 업            | 스케일 아웃             |
| --------- | ---------------- | ------------------ |
| 유지보수 및 관리 | 쉬움               | 여러 노드에 적절히 부하분산 필요 |
| 확장성       | 제약이 있음           | 스케일업에 비해 자유로움      |
| 장애복구      | 서버가 1대, 다운타임이 있음 | 장애 탄력성이 있음         |

### 언제 스케일 아웃이 가능할까?

같은 입력에 대해서는 항상 같은 결과를 반환 

여러개의 서버들은 하나의 데이터를 공유할 수 있도록 하나의 DB를 바라봄

데이터베이스는 데이터라는 상태를 관리하고 있어 서버보다 스케일 아웃을 하기 위해서는 훨씬 많은 비용이 필요

현대 서버 아키텍쳐는 상태관리를 데이터베이스에 위임하고, 서버는 상태관리를 하지 않는 방향으로 발전

스케일 아웃외에도 데이터 베이스는 디스크의 데이터를 접근해서 가져온다.

네트워크 상황에 따라서 언제든지 속도가 달라질 수 있음

### 대용량 트래픽 / 데이터 처리는 왜 어려울까?

하나의 서버 또는 데이터베이스로 감당하기 힘든 부하

-> 다수의 서버와 데이터베이스를 마치 하나인 것 처럼

웹 서비스들은 24시간 무중단

-> 잘못된 코드 한줄이 미치는 영향의 범위가 크다

여러 마이크로 서비스들이 복잡한 의존 관계를 가진다.

-> 많은 팀들이 협업하기 때문에

하나의 서버에서는 join 도 가능하고 여러 트랜잭션 보장들이 쉽게 됨.

여러개의 서버에서 유입되는 데이터의 일관성을 보장할 수 있어야함

### 그렇다면 대용량 시스템은 어떠해야하는가?

- 고가용성
  
  - 언제든지 서비스를 이요할 수 있어야한다.

- 확장성
  
  - 시스템이 비대해짐에 따라 증가하는 데이터와 트래픽에 대응할 수 있어야 한다.

- 관측 가능성
  
  - 문제가 생겼을 때 빠르게 인지할 수 있어야하고, 문제의 범위를 최소화 할 수 있어야 한다.

### 점진적으로 시스템을 발전 시켜보자

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-46-14-image.png)

클라이언트가 많아짐에 따라 

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-46-30-image.png)

스케일 아웃 > 부하 분산을 어떻게 할 것 인가? (nginx 와 같은 로드밸런서를 앞단에 두게 됨 대부분 Roundrobin 혹은 lrub? 알고리즘 을 사용)

아무리 늘려도 db 응답속도가 느림

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-47-37-image.png)

캐시를 도입하기 전에 쿼리 튜닝 등 다양한 최적화 기법이 있음

어떤 캐시를 적용할까?

글로벌 캐시 : REDIS 서버와 같은 여러 서버들이 하나의 캐시를 공유할 수 있도록

로컬 캐시 : 각 서버 메모리에 데이터를 캐싱

캐시 주기 , 만료 정책 ? 어떻게 할 것 인가?

서비스가 점점 커짐에 따라 이메일과 알림과 같은 대외기관과의 연동이 필요해짐

내부적인 서비스는 캐시를 통해 빨라졌지만, 대외기관 연동은 ??

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-49-34-image.png)

비동기큐 (카프카, 레비덴큐?)

하나의 서버내에서 비동기 큐를 사용할 수 있음

대외기관과 연동되는 클라이언트 요청중 트랜잭션을 클라이언트 요청에서 제외

요청을 보낼 땐, DB 에 연동 대외기관 은 비동기 큐

적정 TPS에 맞춰 ~~~~

![](C:\Users\Wook\AppData\Roaming\marktext\images\2022-11-13-02-50-13-image.png)

어떤 문제점을 해결하기위해, ?? 
